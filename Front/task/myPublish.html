<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no,maximum-scale=1.0">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/iconfont.css" />
		<link rel="stylesheet" href="../css/myPublish.css" />
		<link rel="stylesheet" href="../css/time.css" />
		<script src="../js/mui.min.js"></script>
	</head>
<!--我发布的-->
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon iconfont icon-left"></a>
			<h1 class="mui-title">我的发布</h1>
		</header>
		<div class="mui-content">
			<div class="mui-row">
				<div class="mui-col-sm-12 mui-col-xs-12 publisherArea">
					<div>
						<img src="../logo/logo.png" />
					</div>
					<div>
						<h4>执行中</h4>
						<h4 id="performer"></h4>
						<h4 id="performerMobile">手机：<span></span></h4>
						<div>
							<div>
								<i class="mui-icon iconfont icon-shimingrenzheng"></i>
							</div>
							<div>
								<i>认证</i>
							</div>
						</div>
					</div>
				</div>
				<div class="mui-col-sm-12 mui-col-xs-12 completeArea">
					<div>
						<span>已完成0%</span>
						<span>已完成50%</span>
						<span>已完成100%</span>
					</div>
					<ul class="time-horizontal">
				        <li><b></b></li>
				        <li><b></b></li>
				        <li><b></b></li>
				    </ul>
				</div>
				<div class="mui-col-sm-12 mui-col-xs-12 progreesDetails">
					<ul>
				    	<li><h4>查看位置</h4><h5>2018-04-03&nbsp;08:20:38</h5></li>
				    	<!--<li><h4>查看位置</h4><span>2018-04-03&nbsp;08:20:38</span></li>
				    	<li><h4>查看位置</h4><span>2018-04-03&nbsp;08:20:38</span></li>-->
				    </ul>
				</div>
				<div class="mui-col-sm-12 mui-col-xs-12 taskdetails">
					<div align="center">
						<h3 id="taskMoney"></h3>
						<span>任务悬赏金额</span>
					</div>
					<div align="center">
						<h3 id="timeLeft"></h3>
						<h3 id="hideTimeLeft" style="display: none;"></h3>
						<span>任务剩余时间</span>
					</div>
					<div align="center">
						<h3>00:00:00</h3>
						<span>任务延迟时间</span>
					</div>
				</div>
				<div class="mui-col-sm-12 mui-col-xs-12 taskBtns" align="center">
					<div class="mui-content-padded">
						<button type="button" class="mui-btn mui-btn-danger" id="confirmPublish1">确认完成</button>
						<button type="button" class="mui-btn mui-btn-warning">发起取消</button>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			//为date添加格式化原型函数
			Date.prototype.Format = function (fmt) { 
			    var o = {
			        "M+": this.getMonth() + 1, //月份 
			        "d+": this.getDate(), //日 
			        "h+": this.getHours(), //小时 
			        "m+": this.getMinutes(), //分 
			        "s+": this.getSeconds(), //秒 
			        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
			        "S": this.getMilliseconds() //毫秒 
			    };
			    if (/(y+)/.test(fmt)) {
			        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			    }
			    for (var k in o)
			        if (new RegExp("(" + k + ")").test(fmt)) 
			            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
			    return fmt;
			    
			}			
			mui.init();
			mui.plusReady(function(){
			window.self = plus.webview.currentWebview();
			window.id = self.name;
			getMyTask(id);
				document.getElementById("confirmPublish1").addEventListener("tap",function(){
					mui.openWindow({
						url:'myPublishs.html',
						id:'myPublishs',
						extras:{
							money:document.getElementById("taskMoney").textContent,
							time:document.getElementById("hideTimeLeft").textContent
						}
					});
				});
				
			});
			function getMyTask(id){
				mui.ajax({
					url:'http://47.96.156.75/public/index/task/gettaskinfo',
					type:'post',
					data:{
						id:id
					},
					dataType:'json',
					async:true,
					header:{'Content-Type':'application/json'},
					success:function(data){
						var json = JSON.parse(data);
						daojishi = json.task_end_time;
						performer = json.task_get_user;  //获取任务领取者
						document.getElementById("performer").textContent = '执行者:'+performer;
						document.getElementById("performerMobile").textContent = performer;
						document.getElementById("taskMoney").textContent = json.task_money;
						document.getElementById("hideTimeLeft").textContent = daojishi;
						var timeover = new Date(daojishi); 
						countDown(timeover);
					},
					error:function(xhr,type,errorThrown){
						alert(type);
					}
				});
				//关闭等待框
                plus.nativeUI.closeWaiting();
                //显示当前页面
                mui.currentWebview.show();
			}
	//带天数的倒计时
	function countDown(t) {
		var now = new Date();
		var times = ((t - now) / 1000); 
		var timer = null;
		timer = setInterval(function() {
			var day = 0,
				hour = 0,
				minute = 0,
				second = 0; //时间默认值
			if(times > 0) {
				day = Math.floor(times / (60 * 60 * 24));
				hour = Math.floor(times / (60 * 60)) - (day * 24);
				minute = Math.floor(times / 60) - (day * 24 * 60) - (hour * 60);
				second = Math.floor(times) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
			}
			if(day <= 9) day = '0' + day;
			if(hour <= 9) hour = '0' + hour;
			if(minute <= 9) minute = '0' + minute;
			if(second <= 9) second = '0' + second;
			document.getElementById("timeLeft").textContent = hour + ":" + minute + ":" + second;
			times--;
		}, 1000);
		if(times <= 0) {
			clearInterval(timer);
		}
}
</script>
	</body>

</html>